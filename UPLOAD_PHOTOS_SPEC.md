# ğŸ“· Upload Photos - SpÃ©cification ComplÃ¨te

## ğŸ¯ OÃ¹ Ajouter des Photos?

### Option 1: Dans le Modal "Ajouter un Prix" â­ (RecommandÃ©)
**Moment**: Lors de l'ajout d'un nouveau prix
**Avantage**: Photos liÃ©es directement au prix et fournisseur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ajouter un Prix                          [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ Pays: [Chine â–¼]                             â”‚
â”‚ Fournisseur: Alibaba Supplier               â”‚
â”‚ Montant: 500 CNY                             â”‚
â”‚                                              â”‚
â”‚ ğŸ“· Photos du Produit                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [ğŸ“· Ajouter des photos]                â”‚  â”‚
â”‚ â”‚                                        â”‚  â”‚
â”‚ â”‚ [img1] [img2] [img3]                   â”‚  â”‚
â”‚ â”‚  âœ•      âœ•      âœ•                       â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚ Notes: MOQ: 500 sacs...                      â”‚
â”‚                                              â”‚
â”‚                      [Annuler] [Ajouter]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Option 2: Dans le Modal "GÃ©rer les Prix"
**Moment**: AprÃ¨s avoir ajoutÃ© un prix
**Avantage**: Peut ajouter/modifier photos Ã  tout moment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’° Prix - Ciment Portland              [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ ğŸ‡¨ğŸ‡³ Chine                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ Alibaba Supplier                       â”‚  â”‚
â”‚ â”‚ 500 CNY (â‰ˆ 42,000 FCFA)               â”‚  â”‚
â”‚ â”‚                                        â”‚  â”‚
â”‚ â”‚ ğŸ“· Photos (3):                         â”‚  â”‚
â”‚ â”‚ [img1] [img2] [img3]                   â”‚  â”‚
â”‚ â”‚                                        â”‚  â”‚
â”‚ â”‚ [+ Ajouter des photos]                 â”‚  â”‚
â”‚ â”‚                              [âœï¸] [ğŸ—‘ï¸] â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚              [+ Ajouter un Prix]  [Fermer]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Option 3: Modal DÃ©diÃ© "Galerie Photos"
**Moment**: Clic sur les photos d'un prix
**Avantage**: Vue complÃ¨te avec zoom et dÃ©tails

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“· Photos - Alibaba Supplier            [X] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚                                        â”‚  â”‚
â”‚ â”‚         [PHOTO PRINCIPALE]             â”‚  â”‚
â”‚ â”‚                                        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚ Miniatures:                                  â”‚
â”‚ [img1] [img2] [img3] [img4] [+ Ajouter]     â”‚
â”‚                                              â”‚
â”‚ LÃ©gende: Vue du produit en usine            â”‚
â”‚ [Ã‰diter lÃ©gende]                             â”‚
â”‚                                              â”‚
â”‚                                   [Fermer]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Structure des DonnÃ©es

### Table `photos` (Existe dÃ©jÃ !)
```sql
CREATE TABLE photos (
  id SERIAL PRIMARY KEY,
  material_id UUID REFERENCES materials(id),
  price_id INTEGER REFERENCES prices(id) ON DELETE CASCADE,
  url TEXT NOT NULL,
  caption TEXT,
  uploaded_at TIMESTAMP DEFAULT NOW()
);
```

### Stockage Supabase Storage
```
Bucket: project-files
Structure:
  /prices/{price_id}/
    - photo1.jpg
    - photo2.jpg
    - photo3.jpg
```

---

## ğŸ¨ Interface RecommandÃ©e

### 1. Composant Upload dans "Ajouter un Prix"

```tsx
{/* Photos du Produit */}
<div className="grid gap-2">
  <Label>Photos du Produit</Label>
  <div className="border-2 border-dashed rounded-lg p-4">
    <input
      type="file"
      multiple
      accept="image/*"
      onChange={handlePhotoUpload}
      className="hidden"
      id="photo-upload"
    />
    <label
      htmlFor="photo-upload"
      className="flex flex-col items-center cursor-pointer"
    >
      <ImageIcon className="h-12 w-12 text-gray-400 mb-2" />
      <span className="text-sm text-gray-600">
        Cliquez pour ajouter des photos
      </span>
      <span className="text-xs text-gray-500">
        PNG, JPG jusqu'Ã  5MB
      </span>
    </label>
  </div>

  {/* AperÃ§u des photos */}
  {uploadedPhotos.length > 0 && (
    <div className="grid grid-cols-3 gap-2 mt-2">
      {uploadedPhotos.map((photo, index) => (
        <div key={index} className="relative">
          <img
            src={photo.preview}
            alt={`Photo ${index + 1}`}
            className="w-full h-24 object-cover rounded"
          />
          <button
            onClick={() => removePhoto(index)}
            className="absolute top-1 right-1 bg-red-500 text-white rounded-full p-1"
          >
            <X className="h-3 w-3" />
          </button>
        </div>
      ))}
    </div>
  )}
</div>
```

---

## ğŸ”§ Fonctions Ã  ImplÃ©menter

### 1. Upload Photo vers Supabase Storage

```typescript
const handlePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const files = e.target.files;
  if (!files) return;

  try {
    const uploadedUrls: string[] = [];

    for (let i = 0; i < files.length; i++) {
      const file = files[i];
      const fileExt = file.name.split('.').pop();
      const fileName = `${Math.random()}.${fileExt}`;
      const filePath = `prices/${Date.now()}/${fileName}`;

      // Upload vers Supabase Storage
      const { data, error } = await supabase.storage
        .from('project-files')
        .upload(filePath, file);

      if (error) throw error;

      // Obtenir l'URL publique
      const { data: { publicUrl } } = supabase.storage
        .from('project-files')
        .getPublicUrl(filePath);

      uploadedUrls.push(publicUrl);
    }

    setUploadedPhotos(prev => [...prev, ...uploadedUrls]);
    toast.success(`${files.length} photo(s) ajoutÃ©e(s)`);
  } catch (error) {
    console.error('Error uploading photos:', error);
    toast.error('Erreur lors de l\'upload');
  }
};
```

### 2. Sauvegarder les Photos en Base

```typescript
const savePhotosToDatabase = async (priceId: number, photoUrls: string[]) => {
  try {
    const photosData = photoUrls.map(url => ({
      price_id: priceId,
      url: url,
      caption: null,
    }));

    const { error } = await supabase
      .from('photos')
      .insert(photosData);

    if (error) throw error;
  } catch (error) {
    console.error('Error saving photos:', error);
  }
};
```

### 3. Charger les Photos d'un Prix

```typescript
const loadPhotos = async (priceId: number) => {
  try {
    const { data, error } = await supabase
      .from('photos')
      .select('*')
      .eq('price_id', priceId)
      .order('uploaded_at', { ascending: true });

    if (error) throw error;
    return data || [];
  } catch (error) {
    console.error('Error loading photos:', error);
    return [];
  }
};
```

### 4. Supprimer une Photo

```typescript
const deletePhoto = async (photoId: number, photoUrl: string) => {
  try {
    // Supprimer de la base
    const { error: dbError } = await supabase
      .from('photos')
      .delete()
      .eq('id', photoId);

    if (dbError) throw dbError;

    // Supprimer du storage
    const filePath = photoUrl.split('/').slice(-3).join('/');
    const { error: storageError } = await supabase.storage
      .from('project-files')
      .remove([filePath]);

    if (storageError) throw storageError;

    toast.success('Photo supprimÃ©e');
  } catch (error) {
    console.error('Error deleting photo:', error);
    toast.error('Erreur lors de la suppression');
  }
};
```

---

## ğŸ¯ Workflow Complet

### ScÃ©nario 1: Ajout de Prix avec Photos

```
1. Utilisateur clique "Ajouter un Prix"
   â†“
2. Remplit le formulaire
   â†“
3. Clique "Ajouter des photos"
   â†“
4. SÃ©lectionne 3 photos (produit, emballage, Ã©tiquette)
   â†“
5. Photos uploadÃ©es vers Supabase Storage
   â†“
6. AperÃ§u des photos affichÃ©
   â†“
7. Clique "Ajouter"
   â†“
8. Prix crÃ©Ã© en base
   â†“
9. Photos liÃ©es au prix en base
   â†“
10. âœ… Prix avec photos enregistrÃ©!
```

### ScÃ©nario 2: Ajout de Photos AprÃ¨s CrÃ©ation

```
1. Prix dÃ©jÃ  crÃ©Ã© sans photos
   â†“
2. Utilisateur clique sur le prix
   â†“
3. Clique "Ajouter des photos"
   â†“
4. Upload et sauvegarde
   â†“
5. âœ… Photos ajoutÃ©es au prix existant
```

---

## ğŸ“± Types de Photos RecommandÃ©es

### Pour un Fournisseur Chinois
1. **Photo du produit** - Vue principale
2. **Emballage** - Comment c'est livrÃ©
3. **Ã‰tiquette** - SpÃ©cifications techniques
4. **Usine** - Vue de l'installation
5. **Certificats** - QualitÃ©, normes

### Pour un Fournisseur Local
1. **Photo du produit** - En stock
2. **Showroom** - Emplacement
3. **Livraison** - Camion, transport
4. **Facture** - Exemple de prix
5. **Contact** - Carte de visite

---

## ğŸ¨ Galerie Photos - Affichage

### Dans le Modal Prix

```tsx
{price.photos && price.photos.length > 0 && (
  <div className="mt-3">
    <p className="text-sm font-medium mb-2">
      ğŸ“· Photos ({price.photos.length})
    </p>
    <div className="grid grid-cols-4 gap-2">
      {price.photos.map((photo: any) => (
        <div
          key={photo.id}
          className="relative cursor-pointer hover:opacity-80"
          onClick={() => openPhotoGallery(photo)}
        >
          <img
            src={photo.url}
            alt={photo.caption || 'Photo'}
            className="w-full h-20 object-cover rounded"
          />
        </div>
      ))}
    </div>
  </div>
)}
```

---

## ğŸ” SÃ©curitÃ©

### Policies RLS pour Photos

```sql
-- Voir les photos des prix de ses projets
CREATE POLICY "Users can view photos for their prices"
ON photos FOR SELECT
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM prices p
    JOIN materials m ON p.material_id = m.id
    JOIN projects pr ON m.project_id = pr.id
    WHERE photos.price_id = p.id
    AND pr.user_id = auth.uid()
  )
);

-- Ajouter des photos aux prix de ses projets
CREATE POLICY "Users can insert photos for their prices"
ON photos FOR INSERT
TO authenticated
WITH CHECK (
  EXISTS (
    SELECT 1 FROM prices p
    JOIN materials m ON p.material_id = m.id
    JOIN projects pr ON m.project_id = pr.id
    WHERE photos.price_id = p.id
    AND pr.user_id = auth.uid()
  )
);

-- Supprimer les photos de ses prix
CREATE POLICY "Users can delete photos for their prices"
ON photos FOR DELETE
TO authenticated
USING (
  EXISTS (
    SELECT 1 FROM prices p
    JOIN materials m ON p.material_id = m.id
    JOIN projects pr ON m.project_id = pr.id
    WHERE photos.price_id = p.id
    AND pr.user_id = auth.uid()
  )
);
```

---

## âœ… RÃ©sumÃ©

### OÃ¹ Ajouter des Photos?

**1. Dans "Ajouter un Prix"** â­ (RecommandÃ©)
- Lors de la crÃ©ation du prix
- Photos liÃ©es directement

**2. Dans "GÃ©rer les Prix"**
- AprÃ¨s crÃ©ation
- Modification possible

**3. Galerie DÃ©diÃ©e**
- Vue complÃ¨te
- Zoom et dÃ©tails

### Stockage
- **Supabase Storage**: Bucket `project-files`
- **Base de donnÃ©es**: Table `photos` avec `price_id`

### FonctionnalitÃ©s
- âœ… Upload multiple
- âœ… AperÃ§u avant sauvegarde
- âœ… Suppression
- âœ… LÃ©gendes
- âœ… Galerie avec zoom

---

## ğŸš€ Prochaines Ã‰tapes

1. Ajouter le composant upload dans le modal "Ajouter un Prix"
2. ImplÃ©menter les fonctions d'upload
3. CrÃ©er les policies RLS pour photos
4. Afficher les photos dans le modal "GÃ©rer les Prix"
5. CrÃ©er la galerie photos avec zoom

**Voulez-vous que j'implÃ©mente l'upload de photos maintenant?** ğŸ“·
